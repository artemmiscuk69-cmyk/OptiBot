<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OptiBotX PRO</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        /* --- –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, 
               –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ --- */
        :root {
            --bg-color: #050510;
            --app-bg: #0b0b1a;
            --border-color: #1a1a2e;
            --text-color: white;
            --secondary-bg: #161625;
            --hover-color: #2a2a3f;
            --accent: #5b4dff;
            --accent-glow: rgba(91, 77, 255, 0.3);
            --glass-bg: rgba(20, 30, 50, 0.6);
            --glass-border: rgba(255, 255, 255, 0.15);
        }
        body.light-theme {
            --bg-color: #f0f2f5;
            --app-bg: #ffffff;
            --border-color: #ddd;
            --text-color: #222;
            --secondary-bg: #f5f5f5;
            --hover-color: #e0e0e0;
            --accent: #3f51b5;
            --accent-glow: rgba(63, 81, 181, 0.3);
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(0, 0, 0, 0.1);
        }
        body {
            margin: 0; padding: 0; background: var(--bg-color); color: var(--text-color);
            font-family: 'Segoe UI', sans-serif; height: 100vh; 
            display: flex; justify-content: center; align-items: center; overflow: hidden;
            transition: background 0.3s, color 0.3s;
        }

        /* --- –°–¢–ï–ö–õ–Ø–ù–ù–´–ô –≠–ö–†–ê–ù –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) --- */
        .welcome-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s;
            backdrop-filter: blur(10px);
        }
        .welcome-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .welcome-glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            padding: 30px 20px;
            width: 80%;
            max-width: 320px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.9);
            animation: glassAppear 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            transition: transform 0.3s;
        }
        @keyframes glassAppear {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .welcome-title {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 0 0 10px;
            background: linear-gradient(135deg, #fff, #aaccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(91,77,255,0.5);
        }
        .welcome-subtitle {
            font-size: 1rem;
            color: #aaa;
            margin-bottom: 25px;
        }
        .language-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }
        .language-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 14px 20px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        .language-item:hover {
            background: rgba(255,255,255,0.15);
            transform: scale(1.02);
            box-shadow: 0 0 20px var(--accent-glow);
        }
        .language-item.selected {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 0 30px var(--accent-glow);
        }
        .language-item .flag {
            font-size: 1.8rem;
        }
        .start-btn {
            background: var(--accent);
            border: none;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
            padding: 16px 30px;
            border-radius: 40px;
            cursor: pointer;
            box-shadow: 0 0 30px var(--accent-glow);
            transition: all 0.3s;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            width: 100%;
        }
        .start-btn.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 50px var(--accent-glow);
        }

        /* --- –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò (—Å –ø–æ–ª–µ–º –≤–≤–æ–¥–∞) --- */
        .register-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .register-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .register-glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            padding: 30px 20px;
            width: 80%;
            max-width: 320px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.9);
            animation: glassAppear 0.4s forwards;
        }
        .register-glass h3 {
            margin-top: 0;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #fff, #aaccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .register-glass p {
            font-size: 1rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .ref-link {
            color: var(--accent);
            text-decoration: underline;
            word-break: break-all;
            font-size: 0.9rem;
            margin-bottom: 20px;
            display: block;
        }
        .register-input {
            width: 100%;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            color: var(--text-color);
            font-size: 1rem;
            text-align: center;
            margin-bottom: 15px;
            outline: none;
            box-sizing: border-box;
        }
        .register-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent-glow);
        }
        .register-btn {
            background: var(--accent);
            border: none;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 12px 20px;
            border-radius: 40px;
            cursor: pointer;
            width: 100%;
            transition: 0.3s;
            box-shadow: 0 0 20px var(--accent-glow);
            margin-bottom: 10px;
        }
        .register-btn:hover {
            transform: scale(1.05);
        }
        .register-btn:disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .register-message {
            font-size: 0.9rem;
            min-height: 20px;
            color: var(--accent-green);
        }
        .register-message.error {
            color: #ff4d4d;
        }

        /* --- –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫—Ä–æ–º–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤) --- */
        .app-container {
            width: 100%; max-width: 400px; height: 98vh; background: var(--app-bg);
            display: none; /* —Å–∫—Ä—ã—Ç–æ –¥–æ –Ω–∞–∂–∞—Ç–∏—è Start */
            flex-direction: column; padding: 15px; box-sizing: border-box;
            position: relative; border: 1px solid var(--border-color); border-radius: 12px;
            animation: fadeInScale 0.5s ease-out;
            transition: background 0.3s, border-color 0.3s;
        }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .logo h1 { font-size: 18px; margin: 0; color: var(--text-color); animation: glowPulse 2s infinite; }
        .logo span { color: var(--accent); font-weight: 800; text-shadow: 0 0 8px var(--accent); }
        .header-buttons { display: flex; gap: 5px; }
        .icon-btn { 
            background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-color); 
            padding: 5px 8px; border-radius: 6px; cursor: pointer; font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .icon-btn:hover { background: var(--hover-color); transform: scale(1.05); }

        /* --- –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ü–û–ò–°–ö–ê –ò –ü–ê–† (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) --- */
        .selector-container {
            position: relative;
            margin-bottom: 10px;
        }
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #8899ac;
            font-size: 16px;
            pointer-events: none;
            z-index: 2;
        }
        #pair-search {
            width: 100%;
            background: var(--secondary-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px 12px 12px 40px;
            font-size: 14px;
            outline: none;
            box-sizing: border-box;
            transition: all 0.3s;
            margin-bottom: 8px;
        }
        #pair-search:focus {
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent-glow);
        }
        #pair-search::placeholder {
            color: #8899ac;
            font-size: 14px;
        }
        .pairs-container {
            max-height: 250px;
            overflow-y: auto;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 5px 0;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) var(--secondary-bg);
        }
        .pairs-container::-webkit-scrollbar {
            width: 6px;
        }
        .pairs-container::-webkit-scrollbar-track {
            background: var(--secondary-bg);
            border-radius: 10px;
        }
        .pairs-container::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }
        .pair-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .pair-option:last-child {
            border-bottom: none;
        }
        .pair-option:hover {
            background: var(--hover-color);
        }
        .pair-option.selected {
            background: var(--accent);
            color: white;
        }
        .pair-option .pair-flag {
            font-size: 1.2rem;
            min-width: 24px;
            text-align: center;
        }
        .pair-option .pair-name {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
        }
        .pair-option .pair-type {
            font-size: 10px;
            color: #8899ac;
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
        }
        .pair-option.selected .pair-type {
            color: white;
            background: rgba(255,255,255,0.2);
        }

        /* —Å—Ç–∞—Ä—ã–π select —Å–∫—Ä—ã–≤–∞–µ–º */
        #pair {
            display: none;
        }

        /* –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ (–≥—Ä–∞—Ñ–∏–∫, –∫–Ω–æ–ø–∫–∏, –∞–Ω–∏–º–∞—Ü–∏–∏) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .chart-container {
            position: relative;
            width: 100%; height: 280px; margin-bottom: 15px;
        }
        .chart-box { 
            width: 100%; height: 100%; background: var(--app-bg); 
            border-radius: 10px; border: 1px solid var(--border-color);
            position: relative; overflow: hidden;
            transition: box-shadow 0.3s;
        }
        .chart-box:hover { box-shadow: 0 0 20px var(--accent-glow); }
        #mainChart { width: 100%; height: 100%; display: block; }
        .chart-controls {
            position: absolute; top: 5px; right: 5px; display: flex; gap: 5px; z-index: 10;
        }
        .chart-controls button {
            background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-color);
            width: 30px; height: 30px; border-radius: 15px; cursor: pointer; font-weight: bold;
            transition: all 0.3s;
        }
        .chart-controls button:hover { background: var(--accent); color: white; }

        .tf-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 8px; }
        
        .tf-btn { 
            background: var(--secondary-bg); border: 1px solid var(--border-color); color: #666; 
            padding: 10px; border-radius: 8px; font-size: 12px; cursor: pointer; 
            transition: all 0.3s ease;
            position: relative; overflow: hidden;
        }
        
        .tf-btn:hover {
            transform: scale(1.1);
            background: var(--hover-color);
            color: var(--text-color);
            border-color: var(--accent);
            z-index: 10;
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .tf-btn.active { 
            background: var(--accent); color: white; border-color: var(--accent); 
            box-shadow: 0 0 15px var(--accent-glow);
            animation: pulse 1.5s infinite;
        }
        .tf-btn.active:hover { transform: scale(1.1); background: var(--accent); }

        .analyze-btn { 
            width: 100%; background: var(--accent); border: none; padding: 16px; border-radius: 12px; 
            color: white; font-weight: bold; cursor: pointer; font-size: 16px; margin: 10px 0;
            transition: all 0.3s; position: relative; overflow: hidden;
        }
        .analyze-btn:hover { 
            background: var(--accent); transform: translateY(-2px); box-shadow: 0 10px 20px var(--accent-glow);
        }
        .analyze-btn:active { transform: translateY(0); }
        .analyze-btn.loading {
            pointer-events: none; opacity: 0.8;
        }
        .analyze-btn.loading::before {
            content: ''; position: absolute; top: 50%; left: 50%; width: 20px; height: 20px;
            margin-top: -10px; margin-left: -10px; border: 2px solid transparent; border-top-color: white;
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        .analyze-btn.loading span {
            opacity: 0;
        }

        .status-area { 
            display: flex; justify-content: center; align-items: center; gap: 10px; height: 30px; margin-bottom: 10px;
            animation: fadeIn 0.5s;
        }
        .dot { 
            width: 12px; height: 12px; background: #2575fc; border-radius: 50%; 
            box-shadow: 0 0 10px #2575fc;
            animation: pulseDot 1.2s infinite;
        }
        
        .result-display { 
            width: 100%;
            height: 50px;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            line-height: 50px;
            margin-bottom: 10px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            box-sizing: border-box;
        }
        .result-display.visible {
            opacity: 1;
            visibility: visible;
        }

        #snow-layer { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 1000; 
            transition: opacity 0.3s;
        }
        #tooltip {
            position: absolute; background: rgba(0,0,0,0.8); color: white; padding: 4px 8px;
            border-radius: 4px; font-size: 10px; pointer-events: none; z-index: 1001;
            display: none;
        }
        .indicator-btn {
            background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-color);
            padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 10px;
            transition: all 0.3s; margin-right: 5px;
        }
        .indicator-btn.active { background: var(--accent); color: white; }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeInScale { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 var(--accent-glow); } 70% { box-shadow: 0 0 0 10px transparent; } 100% { box-shadow: 0 0 0 0 transparent; } }
        @keyframes pulseDot { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.3); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes glowPulse { 0% { text-shadow: 0 0 2px var(--accent); } 50% { text-shadow: 0 0 15px var(--accent), 0 0 30px var(--accent); } 100% { text-shadow: 0 0 2px var(--accent); } }
        @keyframes ripple { 0% { transform: scale(0, 0); opacity: 1; } 20% { transform: scale(25, 25); opacity: 1; } 100% { opacity: 0; transform: scale(40, 40); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 80% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
        @keyframes shake { 0%,100% { transform: translateX(0); } 20%,60% { transform: translateX(-5px); } 40%,80% { transform: translateX(5px); } }

        .chart-box::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle at 30% 50%, rgba(91, 77, 255, 0.05), transparent 50%);
            animation: rotate 20s linear infinite;
            pointer-events: none;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
<div id="welcome-overlay" class="welcome-overlay visible">
    <div class="welcome-glass">
        <h1 class="welcome-title">Welcome</h1>
        <p class="welcome-subtitle">Choose your language</p>
        <div class="language-list">
            <div class="language-item" data-lang="en"><span class="flag">üá¨üáß</span> English</div>
            <div class="language-item" data-lang="ru"><span class="flag">üá∑üá∫</span> –†—É—Å—Å–∫–∏–π</div>
            <div class="language-item" data-lang="pl"><span class="flag">üáµüá±</span> Polski</div>
            <div class="language-item" data-lang="de"><span class="flag">üá©üá™</span> Deutsch</div>
            <div class="language-item" data-lang="fr"><span class="flag">üá´üá∑</span> Fran√ßais</div>
        </div>
        <button id="start-btn" class="start-btn">Start</button>
    </div>
</div>

<!-- –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò -->
<div id="register-overlay" class="register-overlay">
    <div class="register-glass">
        <h3 id="register-title">üîê Registration</h3>
        <p id="register-text">To use the app, you need to register in Pocket Option via our referral link and make a deposit (min. $10).</p>
        <a id="ref-link" class="ref-link" href="#" target="_blank">üîó Referral link</a>
        <input type="text" id="uid-input" class="register-input" placeholder="Enter your Pocket Option UID">
        <button id="check-uid-btn" class="register-btn">Check & Register</button>
        <div id="register-message" class="register-message"></div>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
<div class="app-container" id="main-app" style="display: none;">
    <canvas id="snow-layer"></canvas>
    <div id="tooltip"></div>

    <header>
        <div class="logo">
            <h1>AI OptiBotX <span>PRO</span></h1>
            <div id="sub-header" style="font-size: 10px; color: #444;">–í—ã–±–µ—Ä–∏ –≤–∞–ª—é—Ç–Ω—É—é –ø–∞—Ä—É</div>
        </div>
        <div class="header-buttons">
            <button id="themeBtn" class="icon-btn" onclick="toggleTheme()">üåì</button>
            <button id="snowToggle" class="icon-btn" onclick="toggleSnow()">‚òÉÔ∏è</button>
            <button id="langBtn" class="icon-btn">üá¨üáß EN</button>
        </div>
    </header>

    <!-- –ü–æ–∏—Å–∫ –∏ —Å–ø–∏—Å–æ–∫ –ø–∞—Ä (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
    <div class="selector-container">
        <span class="search-icon">üîç</span>
        <input type="text" id="pair-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–∞—Ä—ã (EUR, USD, OTC...)">
        <div class="pairs-container" id="pairs-container"></div>
    </div>
    <select id="pair" onchange="changePair()" style="display: none;"></select>

    <!-- –ì—Ä–∞—Ñ–∏–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
    <div class="chart-container">
        <div class="chart-box"><canvas id="mainChart"></canvas></div>
        <div class="chart-controls">
            <button onclick="zoomOut()">‚àí</button>
            <button onclick="zoomIn()">+</button>
        </div>
        <div style="position: absolute; bottom: 5px; left: 5px; display: flex; gap: 5px;">
            <button id="smaBtn" class="indicator-btn" onclick="toggleSMA()">SMA 7</button>
        </div>
    </div>

    <div class="tf-grid">
        <button class="tf-btn" onclick="selectTf(this)">5s</button>
        <button class="tf-btn" onclick="selectTf(this)">10s</button>
        <button class="tf-btn" onclick="selectTf(this)">15s</button>
        <button class="tf-btn" onclick="selectTf(this)">30s</button>
        <button class="tf-btn active" onclick="selectTf(this)">1m</button>
        <button class="tf-btn" onclick="selectTf(this)">2m</button>
        <button class="tf-btn" onclick="selectTf(this)">5m</button>
        <button class="tf-btn" onclick="selectTf(this)">15m</button>
    </div>

    <button id="anBtn" class="analyze-btn" onclick="startAnalysis(this)"><span>–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</span></button>

    <div id="status" class="status-area">
        <div class="dot"></div> <span id="wait-msg">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
    </div>

    <div id="result" class="result-display"></div>
</div>

<script>
    // --- üî• –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyC_pEbBZM5ABpjAUpj-Zd5Dpn1bdRvRG6s", // –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π
        databaseURL: "https://dropbocs-35916-default-rtdb.firebaseio.com/" // –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π
    };
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // --- –¢–í–û–Ø –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê POCKET OPTION ---
    const REF_LINK = "https://pocketoption.com/ref/your_id"; // –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–Æ

    // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
    const canvas = document.getElementById('mainChart');
    const ctx = canvas.getContext('2d');
    const dpr = window.devicePixelRatio || 1;
    let candles = [];
    let smaData = [];
    let showSMA = false;
    let candleCount = 18;
    let snowEnabled = false;
    let curLang = 'en';
    let touchStartX = 0;
    let touchEndX = 0;
    let registered = false;      // —Ñ–ª–∞–≥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–±—É–¥–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏–∑ Firebase)
    let userId = null;           // telegram id

    // --- –°–õ–û–í–ê–†–¨ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π) ---
    const dict = {
        en: { 
            sub: "Select currency pair", 
            an: "Analyze", 
            wait: "Waiting...", 
            up: "BUY ", 
            down: "SELL ",
            welcome: "Welcome",
            chooseLang: "Choose your language",
            flag: "üá¨üáß",
            registerTitle: "üîê Registration",
            registerText: "To use the app, you need to register in Pocket Option via our referral link and make a deposit (min. $10).",
            uidPlaceholder: "Enter your Pocket Option UID",
            checkBtn: "Check & Register",
            successMsg: "‚úÖ Registration successful! You can now use the app.",
            errorMsg: "‚ùå Deposit not found. Make sure you deposited and entered the correct UID.",
            refLink: "üîó Referral link"
        },
        ru: { 
            sub: "–í—ã–±–µ—Ä–∏ –≤–∞–ª—é—Ç–Ω—É—é –ø–∞—Ä—É", 
            an: "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å", 
            wait: "–û–∂–∏–¥–∞–Ω–∏–µ...", 
            up: "–í–í–ï–†–• ", 
            down: "–í–ù–ò–ó ",
            welcome: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å",
            chooseLang: "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫",
            flag: "üá∑üá∫",
            registerTitle: "üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
            registerText: "–ß—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ Pocket Option –ø–æ –Ω–∞—à–µ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ –∏ —Å–¥–µ–ª–∞–π—Ç–µ –¥–µ–ø–æ–∑–∏—Ç (–º–∏–Ω. $10).",
            uidPlaceholder: "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à UID –∏–∑ Pocket Option",
            checkBtn: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å",
            successMsg: "‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.",
            errorMsg: "‚ùå –î–µ–ø–æ–∑–∏—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–ø–æ–ª–Ω–∏–ª–∏ —Å—á—ë—Ç –∏ –≤–≤–µ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π UID.",
            refLink: "üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞"
        },
        pl: {
            sub: "Wybierz parƒô walutowƒÖ",
            an: "Analizuj",
            wait: "Oczekiwanie...",
            up: "W G√ìRƒò ",
            down: "W D√ì≈Å ",
            welcome: "Witaj",
            chooseLang: "Wybierz jƒôzyk",
            flag: "üáµüá±",
            registerTitle: "üîê Rejestracja",
            registerText: "Aby korzystaƒá z aplikacji, zarejestruj siƒô w Pocket Option za pomocƒÖ naszego linku partnerskiego i dokonaj depozytu (min. $10).",
            uidPlaceholder: "Wprowad≈∫ sw√≥j UID z Pocket Option",
            checkBtn: "Sprawd≈∫ i zarejestruj",
            successMsg: "‚úÖ Rejestracja zako≈Ñczona sukcesem! Mo≈ºesz korzystaƒá z aplikacji.",
            errorMsg: "‚ùå Depozyt nie zosta≈Ç znaleziony. Upewnij siƒô, ≈ºe dokona≈Çe≈õ depozytu i poda≈Çe≈õ prawid≈Çowy UID.",
            refLink: "üîó Link partnerski"
        },
        de: {
            sub: "W√§hrungspaar ausw√§hlen",
            an: "Analysieren",
            wait: "Warten...",
            up: "KAUFEN ",
            down: "VERKAUFEN ",
            welcome: "Willkommen",
            chooseLang: "Sprache w√§hlen",
            flag: "üá©üá™",
            registerTitle: "üîê Registrierung",
            registerText: "Um die App zu nutzen, registrieren Sie sich √ºber unseren Partnerlink bei Pocket Option und t√§tigen Sie eine Einzahlung (min. $10).",
            uidPlaceholder: "Geben Sie Ihre Pocket Option UID ein",
            checkBtn: "Pr√ºfen & Registrieren",
            successMsg: "‚úÖ Registrierung erfolgreich! Sie k√∂nnen die App nun nutzen.",
            errorMsg: "‚ùå Einzahlung nicht gefunden. Stellen Sie sicher, dass Sie eingezahlt und die richtige UID eingegeben haben.",
            refLink: "üîó Partnerlink"
        },
        fr: {
            sub: "Choisir une paire de devises",
            an: "Analyser",
            wait: "Attente...",
            up: "ACHAT ",
            down: "VENTE ",
            welcome: "Bienvenue",
            chooseLang: "Choisissez la langue",
            flag: "üá´üá∑",
            registerTitle: "üîê Inscription",
            registerText: "Pour utiliser l'application, inscrivez-vous sur Pocket Option via notre lien de parrainage et effectuez un d√©p√¥t (min. $10).",
            uidPlaceholder: "Entrez votre UID Pocket Option",
            checkBtn: "V√©rifier & s'inscrire",
            successMsg: "‚úÖ Inscription r√©ussie ! Vous pouvez maintenant utiliser l'application.",
            errorMsg: "‚ùå D√©p√¥t introuvable. Assurez-vous d'avoir d√©pos√© et saisi le bon UID.",
            refLink: "üîó Lien de parrainage"
        }
    };

    // --- –≠–õ–ï–ú–ï–ù–¢–´ –£–ü–†–ê–í–õ–ï–ù–ò–Ø ---
    const welcomeOverlay = document.getElementById('welcome-overlay');
    const startBtn = document.getElementById('start-btn');
    const langItems = document.querySelectorAll('.language-item');
    const registerOverlay = document.getElementById('register-overlay');
    const uidInput = document.getElementById('uid-input');
    const checkUidBtn = document.getElementById('check-uid-btn');
    const registerMessage = document.getElementById('register-message');
    const refLinkElement = document.getElementById('ref-link');

    // --- –≠–õ–ï–ú–ï–ù–¢–´ –ü–û–ò–°–ö–ê –ü–ê–† ---
    const pairsContainer = document.getElementById('pairs-container');
    const searchInput = document.getElementById('pair-search');
    const hiddenSelect = document.getElementById('pair');

    // --- –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –ü–ê–† (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
    const allPairs = [
        { name: "EUR/USD", flag: "üá™üá∫üá∫üá∏", type: "Major" },
        { name: "GBP/USD", flag: "üá¨üáßüá∫üá∏", type: "Major" },
        { name: "USD/JPY", flag: "üá∫üá∏üáØüáµ", type: "Major" },
        { name: "USD/CHF", flag: "üá∫üá∏üá®üá≠", type: "Major" },
        { name: "AUD/USD", flag: "üá¶üá∫üá∫üá∏", type: "Major" },
        { name: "USD/CAD", flag: "üá∫üá∏üá®üá¶", type: "Major" },
        { name: "NZD/USD", flag: "üá≥üáøüá∫üá∏", type: "Major" },
        { name: "EUR/GBP", flag: "üá™üá∫üá¨üáß", type: "Cross" },
        { name: "EUR/JPY", flag: "üá™üá∫üáØüáµ", type: "Cross" },
        { name: "EUR/CHF", flag: "üá™üá∫üá®üá≠", type: "Cross" },
        { name: "EUR/CAD", flag: "üá™üá∫üá®üá¶", type: "Cross" },
        { name: "EUR/AUD", flag: "üá™üá∫üá¶üá∫", type: "Cross" },
        { name: "EUR/NZD", flag: "üá™üá∫üá≥üáø", type: "Cross" },
        { name: "GBP/JPY", flag: "üá¨üáßüáØüáµ", type: "Cross" },
        { name: "GBP/CHF", flag: "üá¨üáßüá®üá≠", type: "Cross" },
        { name: "GBP/CAD", flag: "üá¨üáßüá®üá¶", type: "Cross" },
        { name: "GBP/AUD", flag: "üá¨üáßüá¶üá∫", type: "Cross" },
        { name: "GBP/NZD", flag: "üá¨üáßüá≥üáø", type: "Cross" },
        { name: "CHF/JPY", flag: "üá®üá≠üáØüáµ", type: "Cross" },
        { name: "CAD/JPY", flag: "üá®üá¶üáØüáµ", type: "Cross" },
        { name: "AUD/JPY", flag: "üá¶üá∫üáØüáµ", type: "Cross" },
        { name: "AUD/CHF", flag: "üá¶üá∫üá®üá≠", type: "Cross" },
        { name: "AUD/CAD", flag: "üá¶üá∫üá®üá¶", type: "Cross" },
        { name: "AUD/NZD", flag: "üá¶üá∫üá≥üáø", type: "Cross" },
        { name: "NZD/JPY", flag: "üá≥üáøüáØüáµ", type: "Cross" },
        { name: "NZD/CHF", flag: "üá≥üáøüá®üá≠", type: "Cross" },
        { name: "NZD/CAD", flag: "üá≥üáøüá®üá¶", type: "Cross" },
        { name: "USD/TRY OTC", flag: "üá∫üá∏üáπüá∑", type: "OTC" },
        { name: "USD/SEK OTC", flag: "üá∫üá∏üá∏üá™", type: "OTC" },
        { name: "USD/NOK OTC", flag: "üá∫üá∏üá≥üá¥", type: "OTC" },
        { name: "USD/DKK OTC", flag: "üá∫üá∏üá©üá∞", type: "OTC" },
        { name: "USD/ZAR OTC", flag: "üá∫üá∏üáøüá¶", type: "OTC" },
        { name: "USD/MXN OTC", flag: "üá∫üá∏üá≤üáΩ", type: "OTC" },
        { name: "USD/PLN OTC", flag: "üá∫üá∏üáµüá±", type: "OTC" },
        { name: "USD/HUF OTC", flag: "üá∫üá∏üá≠üá∫", type: "OTC" },
        { name: "USD/CZK OTC", flag: "üá∫üá∏üá®üáø", type: "OTC" },
        { name: "USD/SGD OTC", flag: "üá∫üá∏üá∏üá¨", type: "OTC" },
        { name: "USD/HKD OTC", flag: "üá∫üá∏üá≠üá∞", type: "OTC" },
        { name: "USD/KRW OTC", flag: "üá∫üá∏üá∞üá∑", type: "OTC" },
        { name: "USD/INR OTC", flag: "üá∫üá∏üáÆüá≥", type: "OTC" },
        { name: "USD/BRL OTC", flag: "üá∫üá∏üáßüá∑", type: "OTC" },
        { name: "USD/CNY OTC", flag: "üá∫üá∏üá®üá≥", type: "OTC" },
        { name: "USD/RUB OTC", flag: "üá∫üá∏üá∑üá∫", type: "OTC" },
        { name: "EUR/TRY OTC", flag: "üá™üá∫üáπüá∑", type: "OTC" },
        { name: "EUR/SEK OTC", flag: "üá™üá∫üá∏üá™", type: "OTC" },
        { name: "EUR/NOK OTC", flag: "üá™üá∫üá≥üá¥", type: "OTC" },
        { name: "EUR/PLN OTC", flag: "üá™üá∫üáµüá±", type: "OTC" },
        { name: "EUR/HUF OTC", flag: "üá™üá∫üá≠üá∫", type: "OTC" },
        { name: "EUR/CZK OTC", flag: "üá™üá∫üá®üáø", type: "OTC" },
        { name: "GBP/TRY OTC", flag: "üá¨üáßüáπüá∑", type: "OTC" },
        { name: "GBP/ZAR OTC", flag: "üá¨üáßüáøüá¶", type: "OTC" },
        { name: "AUD/TRY OTC", flag: "üá¶üá∫üáπüá∑", type: "OTC" },
        { name: "NZD/TRY OTC", flag: "üá≥üáøüáπüá∑", type: "OTC" },
        { name: "CAD/TRY OTC", flag: "üá®üá¶üáπüá∑", type: "OTC" },
        { name: "CHF/TRY OTC", flag: "üá®üá≠üáπüá∑", type: "OTC" },
        { name: "JPY/TRY OTC", flag: "üáØüáµüáπüá∑", type: "OTC" },
        { name: "SGD/JPY OTC", flag: "üá∏üá¨üáØüáµ", type: "OTC" },
        { name: "ZAR/JPY OTC", flag: "üáøüá¶üáØüáµ", type: "OTC" },
        { name: "TRY/JPY OTC", flag: "üáπüá∑üáØüáµ", type: "OTC" },
        { name: "EUR/RUB OTC", flag: "üá™üá∫üá∑üá∫", type: "OTC" },
        { name: "USD/THB OTC", flag: "üá∫üá∏üáπüá≠", type: "OTC" },
        { name: "USD/IDR OTC", flag: "üá∫üá∏üáÆüá©", type: "OTC" },
        { name: "USD/PHP OTC", flag: "üá∫üá∏üáµüá≠", type: "OTC" },
        { name: "USD/VND OTC", flag: "üá∫üá∏üáªüá≥", type: "OTC" },
        { name: "USD/PKR OTC", flag: "üá∫üá∏üáµüá∞", type: "OTC" },
        { name: "USD/BDT OTC", flag: "üá∫üá∏üáßüá©", type: "OTC" },
        { name: "USD/LKR OTC", flag: "üá∫üá∏üá±üá∞", type: "OTC" },
        { name: "USD/MMK OTC", flag: "üá∫üá∏üá≤üá≤", type: "OTC" },
        { name: "USD/KWD OTC", flag: "üá∫üá∏üá∞üáº", type: "OTC" },
        { name: "USD/SAR OTC", flag: "üá∫üá∏üá∏üá¶", type: "OTC" },
        { name: "USD/AED OTC", flag: "üá∫üá∏üá¶üá™", type: "OTC" },
        { name: "USD/QAR OTC", flag: "üá∫üá∏üá∂üá¶", type: "OTC" },
        { name: "USD/BHD OTC", flag: "üá∫üá∏üáßüá≠", type: "OTC" },
        { name: "USD/OMR OTC", flag: "üá∫üá∏üá¥üá≤", type: "OTC" },
        { name: "USD/JOD OTC", flag: "üá∫üá∏üáØüá¥", type: "OTC" },
        { name: "USD/ILS OTC", flag: "üá∫üá∏üáÆüá±", type: "OTC" },
        { name: "EUR/GEL OTC", flag: "üá™üá∫üá¨üá™", type: "OTC" },
        { name: "EUR/AMD OTC", flag: "üá™üá∫üá¶üá≤", type: "OTC" },
        { name: "EUR/AZN OTC", flag: "üá™üá∫üá¶üáø", type: "OTC" },
        { name: "EUR/BYN OTC", flag: "üá™üá∫üáßüáæ", type: "OTC" },
        { name: "EUR/KZT OTC", flag: "üá™üá∫üá∞üáø", type: "OTC" },
        { name: "EUR/UZS OTC", flag: "üá™üá∫üá∫üáø", type: "OTC" },
        { name: "EUR/TMT OTC", flag: "üá™üá∫üáπüá≤", type: "OTC" },
        { name: "EUR/TJS OTC", flag: "üá™üá∫üáπüáØ", type: "OTC" },
        { name: "EUR/KGS OTC", flag: "üá™üá∫üá∞üá¨", type: "OTC" },
        { name: "GBP/SEK OTC", flag: "üá¨üáßüá∏üá™", type: "OTC" },
        { name: "GBP/NOK OTC", flag: "üá¨üáßüá≥üá¥", type: "OTC" },
        { name: "GBP/DKK OTC", flag: "üá¨üáßüá©üá∞", type: "OTC" },
        { name: "GBP/PLN OTC", flag: "üá¨üáßüáµüá±", type: "OTC" },
        { name: "GBP/HUF OTC", flag: "üá¨üáßüá≠üá∫", type: "OTC" },
        { name: "GBP/CZK OTC", flag: "üá¨üáßüá®üáø", type: "OTC" },
        { name: "GBP/SGD OTC", flag: "üá¨üáßüá∏üá¨", type: "OTC" },
        { name: "GBP/HKD OTC", flag: "üá¨üáßüá≠üá∞", type: "OTC" },
        { name: "GBP/INR OTC", flag: "üá¨üáßüáÆüá≥", type: "OTC" },
        { name: "GBP/BRL OTC", flag: "üá¨üáßüáßüá∑", type: "OTC" },
        { name: "AUD/SGD OTC", flag: "üá¶üá∫üá∏üá¨", type: "OTC" },
        { name: "AUD/HKD OTC", flag: "üá¶üá∫üá≠üá∞", type: "OTC" },
        { name: "AUD/ZAR OTC", flag: "üá¶üá∫üáøüá¶", type: "OTC" },
        { name: "AUD/MXN OTC", flag: "üá¶üá∫üá≤üáΩ", type: "OTC" },
        { name: "NZD/SGD OTC", flag: "üá≥üáøüá∏üá¨", type: "OTC" },
        { name: "NZD/HKD OTC", flag: "üá≥üáøüá≠üá∞", type: "OTC" },
        { name: "NZD/ZAR OTC", flag: "üá≥üáøüáøüá¶", type: "OTC" },
        { name: "CAD/SGD OTC", flag: "üá®üá¶üá∏üá¨", type: "OTC" },
        { name: "CAD/HKD OTC", flag: "üá®üá¶üá≠üá∞", type: "OTC" },
        { name: "CAD/ZAR OTC", flag: "üá®üá¶üáøüá¶", type: "OTC" },
        { name: "CHF/SGD OTC", flag: "üá®üá≠üá∏üá¨", type: "OTC" },
        { name: "CHF/HKD OTC", flag: "üá®üá≠üá≠üá∞", type: "OTC" },
        { name: "CHF/ZAR OTC", flag: "üá®üá≠üáøüá¶", type: "OTC" },
        { name: "JPY/SGD OTC", flag: "üáØüáµüá∏üá¨", type: "OTC" },
        { name: "JPY/HKD OTC", flag: "üáØüáµüá≠üá∞", type: "OTC" },
        { name: "JPY/KRW OTC", flag: "üáØüáµüá∞üá∑", type: "OTC" },
        { name: "JPY/CNY OTC", flag: "üáØüáµüá®üá≥", type: "OTC" },
        { name: "EUR/SEK", flag: "üá™üá∫üá∏üá™", type: "Exotic" },
        { name: "EUR/NOK", flag: "üá™üá∫üá≥üá¥", type: "Exotic" },
        { name: "USD/SEK", flag: "üá∫üá∏üá∏üá™", type: "Exotic" },
        { name: "USD/NOK", flag: "üá∫üá∏üá≥üá¥", type: "Exotic" },
        { name: "USD/DKK", flag: "üá∫üá∏üá©üá∞", type: "Exotic" },
        { name: "USD/ZAR", flag: "üá∫üá∏üáøüá¶", type: "Exotic" },
        { name: "USD/MXN", flag: "üá∫üá∏üá≤üáΩ", type: "Exotic" },
        { name: "USD/PLN", flag: "üá∫üá∏üáµüá±", type: "Exotic" },
        { name: "USD/HUF", flag: "üá∫üá∏üá≠üá∫", type: "Exotic" },
        { name: "USD/CZK", flag: "üá∫üá∏üá®üáø", type: "Exotic" },
        { name: "USD/SGD", flag: "üá∫üá∏üá∏üá¨", type: "Exotic" },
        { name: "USD/HKD", flag: "üá∫üá∏üá≠üá∞", type: "Exotic" },
        { name: "USD/KRW", flag: "üá∫üá∏üá∞üá∑", type: "Exotic" },
        { name: "USD/INR", flag: "üá∫üá∏üáÆüá≥", type: "Exotic" },
        { name: "USD/BRL", flag: "üá∫üá∏üáßüá∑", type: "Exotic" },
        { name: "USD/CNY", flag: "üá∫üá∏üá®üá≥", type: "Exotic" },
        { name: "USD/RUB", flag: "üá∫üá∏üá∑üá∫", type: "Exotic" },
        { name: "EUR/RUB", flag: "üá™üá∫üá∑üá∫", type: "Exotic" },
        { name: "GBP/SEK", flag: "üá¨üáßüá∏üá™", type: "Exotic" },
        { name: "GBP/NOK", flag: "üá¨üáßüá≥üá¥", type: "Exotic" },
        { name: "AUD/MXN", flag: "üá¶üá∫üá≤üáΩ", type: "Exotic" },
        { name: "AUD/ZAR", flag: "üá¶üá∫üáøüá¶", type: "Exotic" },
        { name: "NZD/MXN", flag: "üá≥üáøüá≤üáΩ", type: "Exotic" },
        { name: "NZD/ZAR", flag: "üá≥üáøüáøüá¶", type: "Exotic" },
        { name: "CAD/MXN", flag: "üá®üá¶üá≤üáΩ", type: "Exotic" },
        { name: "CAD/ZAR", flag: "üá®üá¶üáøüá¶", type: "Exotic" },
        { name: "CHF/MXN", flag: "üá®üá≠üá≤üáΩ", type: "Exotic" },
        { name: "CHF/ZAR", flag: "üá®üá≠üáøüá¶", type: "Exotic" },
        { name: "JPY/MXN", flag: "üáØüáµüá≤üáΩ", type: "Exotic" },
        { name: "JPY/ZAR", flag: "üáØüáµüáøüá¶", type: "Exotic" },
        { name: "EUR/TRY", flag: "üá™üá∫üáπüá∑", type: "Exotic" },
        { name: "GBP/TRY", flag: "üá¨üáßüáπüá∑", type: "Exotic" },
        { name: "AUD/TRY", flag: "üá¶üá∫üáπüá∑", type: "Exotic" },
        { name: "NZD/TRY", flag: "üá≥üáøüáπüá∑", type: "Exotic" },
        { name: "CAD/TRY", flag: "üá®üá¶üáπüá∑", type: "Exotic" },
        { name: "CHF/TRY", flag: "üá®üá≠üáπüá∑", type: "Exotic" },
        { name: "JPY/TRY", flag: "üáØüáµüáπüá∑", type: "Exotic" }
    ];

    // --- –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° FIREBASE ---
    async function getUserStatus() {
        if (!userId) return false;
        const snapshot = await database.ref('users/' + userId).once('value');
        const data = snapshot.val();
        return data?.registered || false;
    }

    async function setUserRegistered(uid) {
        if (!userId) return;
        await database.ref('users/' + userId).set({
            registered: true,
            uid: uid,
            registeredAt: Date.now()
        });
    }

    // --- –ó–ê–ì–õ–£–®–ö–ê –ü–†–û–í–ï–†–ö–ò –î–ï–ü–û–ó–ò–¢–ê (–ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê –†–ï–ê–õ–¨–ù–£–Æ) ---
    async function checkDeposit(uid) {
        // TODO: –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏–ª–∏ Pocket Option API
        // –°–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ UID –Ω–µ –ø—É—Å—Ç–æ–π (–¥–ª—è —Ç–µ—Å—Ç–∞)
        return new Promise(resolve => {
            setTimeout(() => {
                // –ò–º–∏—Ç–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞, –µ—Å–ª–∏ UID –¥–ª–∏–Ω–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤
                const success = uid && uid.length > 3;
                resolve(success);
            }, 1000);
        });
    }

    // --- –û–ë–†–ê–ë–û–¢–ö–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò ---
    async function handleRegistration() {
        const uid = uidInput.value.trim();
        if (!uid) {
            registerMessage.innerText = dict[curLang].uidPlaceholder;
            registerMessage.classList.add('error');
            return;
        }
        checkUidBtn.disabled = true;
        registerMessage.innerText = '‚è≥ Checking...';
        registerMessage.classList.remove('error');
        const success = await checkDeposit(uid);
        if (success) {
            await setUserRegistered(uid);
            registerOverlay.classList.remove('visible');
            registered = true;
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–π—Å—Ç–≤–∏–∏
            localStorage.setItem('registered_' + userId, 'true');
        } else {
            registerMessage.innerText = dict[curLang].errorMsg;
            registerMessage.classList.add('error');
        }
        checkUidBtn.disabled = false;
    }

    // --- –û–ë–†–ê–ë–û–¢–ö–ê –í–´–ë–û–†–ê –Ø–ó–´–ö–ê ---
    langItems.forEach(item => {
        item.addEventListener('click', () => {
            langItems.forEach(i => i.classList.remove('selected'));
            item.classList.add('selected');
            const lang = item.dataset.lang;
            curLang = lang;
            startBtn.classList.add('visible');
            document.querySelector('.welcome-title').innerText = dict[lang].welcome;
            document.querySelector('.welcome-subtitle').innerText = dict[lang].chooseLang;
        });
    });

    // --- –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–ö–ò START ---
    startBtn.addEventListener('click', async () => {
        welcomeOverlay.classList.remove('visible');
        const app = document.getElementById('main-app');
        app.style.display = 'flex';

        // –ü–æ–ª—É—á–∞–µ–º Telegram ID
        if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
            userId = window.Telegram.WebApp.initDataUnsafe.user.id.toString();
        } else {
            // –î–ª—è —Ç–µ—Å—Ç–∞ –≤–Ω–µ Telegram
            userId = 'test_user_' + Math.random().toString(36).substr(2, 9);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Firebase
        registered = await getUserStatus();

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–∞—Ä
        allPairs.forEach(p => {
            const option = document.createElement('option');
            option.value = p.name;
            option.text = p.name;
            hiddenSelect.appendChild(option);
        });
        if (allPairs.length > 0) {
            hiddenSelect.value = allPairs[0].name;
        }
        renderPairs();
        initChart();
        setupSnow();
        updateUILang();

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
        refLinkElement.href = REF_LINK;
        refLinkElement.innerText = dict[curLang].refLink;
    });

    // --- –§–£–ù–ö–¶–ò–Ø –ü–†–û–í–ï–†–ö–ò –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò –ü–†–ò –ü–û–ü–´–¢–ö–ï –î–ï–ô–°–¢–í–ò–Ø ---
    function requireRegistration() {
        if (!registered) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—ã –≤ –æ–∫–Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ
            document.getElementById('register-title').innerText = dict[curLang].registerTitle;
            document.getElementById('register-text').innerText = dict[curLang].registerText;
            uidInput.placeholder = dict[curLang].uidPlaceholder;
            document.getElementById('check-uid-btn').innerText = dict[curLang].checkBtn;
            refLinkElement.innerText = dict[curLang].refLink;
            refLinkElement.href = REF_LINK;
            registerMessage.innerText = '';
            registerOverlay.classList.add('visible');
            return true;
        }
        return false;
    }

    // --- –ü–ï–†–ï–û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π) ---
    const originalStartAnalysis = window.startAnalysis;
    window.startAnalysis = function(btn) {
        if (requireRegistration()) return;
        originalStartAnalysis(btn);
    };

    const originalSelectTf = window.selectTf;
    window.selectTf = function(btn) {
        if (requireRegistration()) return;
        originalSelectTf(btn);
    };

    const originalChangePair = window.changePair;
    window.changePair = function() {
        if (requireRegistration()) return;
        originalChangePair();
    };

    const originalToggleSMA = window.toggleSMA;
    window.toggleSMA = function() {
        if (requireRegistration()) return;
        originalToggleSMA();
    };

    const originalZoomIn = window.zoomIn;
    window.zoomIn = function() {
        if (requireRegistration()) return;
        originalZoomIn();
    };

    const originalZoomOut = window.zoomOut;
    window.zoomOut = function() {
        if (requireRegistration()) return;
        originalZoomOut();
    };

    // --- –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–ö–ò –ü–†–û–í–ï–†–ö–ò UID ---
    checkUidBtn.addEventListener('click', handleRegistration);

    // --- –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
    function renderPairs(filter = '') {
        const filterLower = filter.toLowerCase();
        const filtered = allPairs.filter(p => 
            p.name.toLowerCase().includes(filterLower) || 
            p.type.toLowerCase().includes(filterLower)
        );
        
        pairsContainer.innerHTML = '';
        filtered.forEach(pair => {
            const div = document.createElement('div');
            div.className = 'pair-option';
            if (pair.name === hiddenSelect.value) {
                div.classList.add('selected');
            }
            div.innerHTML = `
                <span class="pair-flag">${pair.flag}</span>
                <span class="pair-name">${pair.name}</span>
                <span class="pair-type">${pair.type}</span>
            `;
            div.addEventListener('click', () => {
                document.querySelectorAll('.pair-option').forEach(el => el.classList.remove('selected'));
                div.classList.add('selected');
                hiddenSelect.value = pair.name;
                changePair();
            });
            pairsContainer.appendChild(div);
        });

        if (filtered.length === 0) {
            const empty = document.createElement('div');
            empty.className = 'pair-option';
            empty.style.justifyContent = 'center';
            empty.style.padding = '20px';
            empty.innerText = '‚ùå Nothing found';
            pairsContainer.appendChild(empty);
        }
    }

    searchInput.addEventListener('input', (e) => {
        renderPairs(e.target.value);
    });

    // --- –°–ù–ï–ì ---
    const sCanvas = document.getElementById('snow-layer');
    const sCtx = sCanvas.getContext('2d');
    let flakes = [];
    let snowAnimation;

    function setupSnow() {
        sCanvas.width = sCanvas.parentElement.clientWidth;
        sCanvas.height = sCanvas.parentElement.clientHeight;
        flakes = Array.from({length: 60}, () => ({
            x: Math.random()*sCanvas.width, y: Math.random()*sCanvas.height, r: Math.random()*3+1, d: Math.random()*1+0.5, angle: Math.random()*360
        }));
        if (snowAnimation) cancelAnimationFrame(snowAnimation);
        drawSnow();
    }

    function drawSnow() {
        if (!snowEnabled) {
            sCtx.clearRect(0,0,sCanvas.width, sCanvas.height);
            snowAnimation = requestAnimationFrame(drawSnow);
            return;
        }
        sCtx.clearRect(0,0,sCanvas.width, sCanvas.height);
        sCtx.fillStyle = "rgba(255,255,255,0.6)";
        flakes.forEach(f => {
            sCtx.save();
            sCtx.translate(f.x, f.y);
            sCtx.rotate(f.angle * Math.PI/180);
            sCtx.beginPath(); sCtx.arc(0, 0, f.r, 0, Math.PI*2); sCtx.fill();
            sCtx.restore();
            f.y += f.d; f.x += Math.sin(f.angle) * 0.2;
            if(f.y > sCanvas.height) { f.y = -5; f.x = Math.random()*sCanvas.width; }
            if(f.x > sCanvas.width) f.x = 0; if(f.x < 0) f.x = sCanvas.width;
        });
        snowAnimation = requestAnimationFrame(drawSnow);
    }

    function toggleSnow() {
        snowEnabled = !snowEnabled;
        document.getElementById('snowToggle').innerText = snowEnabled ? '‚ùÑÔ∏è' : '‚òÉÔ∏è';
    }

    function toggleTheme() {
        document.body.classList.toggle('light-theme');
    }

    // --- –Ø–∑—ã–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ---
    document.getElementById('langBtn').onclick = function() {
        const langs = ['en', 'ru', 'pl', 'de', 'fr'];
        let idx = langs.indexOf(curLang);
        idx = (idx + 1) % langs.length;
        curLang = langs[idx];
        this.innerHTML = `${dict[curLang].flag} ${curLang.toUpperCase()}`;
        updateUILang();
    };

    function updateUILang() {
        document.getElementById('sub-header').innerText = dict[curLang].sub;
        document.getElementById('anBtn').innerHTML = `<span>${dict[curLang].an}</span>`;
        document.getElementById('wait-msg').innerText = dict[curLang].wait;
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∏—Å–∫ (placeholder)
        document.getElementById('pair-search').placeholder = dict[curLang].sub; // –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å
    }

    // --- –ì–†–ê–§–ò–ö ---
    function setupCanvas() {
        const rect = canvas.parentElement.getBoundingClientRect();
        canvas.width = rect.width * dpr; canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        canvas.style.width = rect.width + 'px'; canvas.style.height = rect.height + 'px';
    }

    function initChart() {
        setupCanvas(); candles = [];
        let price = 100;
        for(let i=0; i<candleCount; i++) { 
            let open = price;
            let close = price + (Math.random() - 0.5) * 15;
            candles.push({ 
                open, close, 
                high: Math.max(open, close) + Math.random()*5 + 3, 
                low: Math.min(open, close) - Math.random()*5 - 3,
                progress: 1
            });
            price = close;
        }
        calculateSMA();
        render();
    }

    function calculateSMA(period = 7) {
        smaData = [];
        for (let i = period-1; i < candles.length; i++) {
            let sum = 0;
            for (let j = i-period+1; j <= i; j++) sum += candles[j].close;
            smaData.push({ index: i, value: sum/period });
        }
    }

    function drawGrid(w, h, minP, maxP) {
        ctx.strokeStyle = "#1e1e2f";
        ctx.lineWidth = 0.5;
        const levels = 5;
        for (let i = 0; i <= levels; i++) {
            let y = h * 0.15 + (h * 0.7 / levels) * i;
            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y);
            ctx.strokeStyle = document.body.classList.contains('light-theme') ? "#ccc" : "#1e1e2f";
            ctx.stroke();
            let price = maxP - (i / levels) * (maxP - minP);
            ctx.fillStyle = "#666"; ctx.font = "8px 'Segoe UI'";
            ctx.fillText(price.toFixed(2), 5, y-2);
        }
        for (let i = 1; i < candles.length; i++) {
            let x = (i / candles.length) * w;
            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h);
            ctx.strokeStyle = document.body.classList.contains('light-theme') ? "#ddd" : "#1a1a2a";
            ctx.stroke();
        }
    }

    function render() {
        const w = canvas.width / dpr; const h = canvas.height / dpr;
        ctx.clearRect(0,0, w, h);
        const allPrices = candles.flatMap(c => [c.high, c.low]);
        const minP = Math.min(...allPrices); const maxP = Math.max(...allPrices);
        const range = (maxP - minP) || 10;
        const getY = (p) => h - ((p - minP) / range) * (h * 0.7) - (h * 0.15);

        drawGrid(w, h, minP, maxP);

        const candleWidth = w / candles.length;
        candles.forEach((c, i) => {
            const x = i * candleWidth + (candleWidth * 0.15);
            const isUp = c.close >= c.open;
            const color = isUp ? '#00ff88' : '#ff4d4d';
            
            ctx.strokeStyle = color; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(x + (candleWidth * 0.35), getY(c.high)); ctx.lineTo(x + (candleWidth * 0.35), getY(c.low)); ctx.stroke();

            let openY = getY(c.open);
            let closeY = getY(c.close);
            let bodyY, bodyH;
            if (isUp) {
                let currentCloseY = openY - (openY - closeY) * c.progress;
                bodyY = currentCloseY; bodyH = openY - currentCloseY;
            } else {
                let currentCloseY = openY + (closeY - openY) * c.progress;
                bodyY = openY; bodyH = currentCloseY - openY;
            }
            if (c.progress > 0 && bodyH > 0.5) {
                ctx.fillStyle = color;
                ctx.beginPath();
                let rectX = x, rectY = bodyY, rectW = candleWidth * 0.7, rectH = bodyH, radius = 2;
                ctx.moveTo(rectX + radius, rectY); ctx.lineTo(rectX + rectW - radius, rectY);
                ctx.quadraticCurveTo(rectX + rectW, rectY, rectX + rectW, rectY + radius);
                ctx.lineTo(rectX + rectW, rectY + rectH - radius);
                ctx.quadraticCurveTo(rectX + rectW, rectY + rectH, rectX + rectW - radius, rectY + rectH);
                ctx.lineTo(rectX + radius, rectY + rectH);
                ctx.quadraticCurveTo(rectX, rectY + rectH, rectX, rectY + rectH - radius);
                ctx.lineTo(rectX, rectY + radius);
                ctx.quadraticCurveTo(rectX, rectY, rectX + radius, rectY);
                ctx.closePath(); ctx.fill();
            }
        });

        if (showSMA && smaData.length > 1) {
            ctx.beginPath(); ctx.strokeStyle = '#ffaa00'; ctx.lineWidth = 2;
            smaData.forEach((pt, idx) => {
                let x = (pt.index / candles.length) * w + candleWidth/2;
                let y = getY(pt.value);
                if (idx === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            });
            ctx.stroke();
        }
    }

    setInterval(() => {
        if(candles.length === 0) return;
        candles.shift();
        let last = candles[candles.length-1];
        let nO = last.close;
        let nC = nO + (Math.random() - 0.5) * 8;
        let newCandle = { 
            open: nO, close: nC, 
            high: Math.max(nO, nC) + Math.random()*4 + 2, 
            low: Math.min(nO, nC) - Math.random()*4 - 2,
            progress: 0 
        };
        candles.push(newCandle);
        calculateSMA();
        let progress = 0;
        function animateNew() { progress += 0.05; newCandle.progress = Math.min(progress, 1); render(); if (progress < 1) requestAnimationFrame(animateNew); }
        animateNew();
    }, 3000);

    function zoomIn() {
        if (candleCount > 5) candleCount -= 2;
        initChart();
    }
    function zoomOut() {
        if (candleCount < 30) candleCount += 2;
        initChart();
    }

    function toggleSMA() {
        showSMA = !showSMA;
        document.getElementById('smaBtn').classList.toggle('active', showSMA);
        render();
    }

    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const x = (e.clientX - rect.left) * scaleX / dpr;
        const candleWidth = (canvas.width / dpr) / candles.length;
        const idx = Math.floor(x / candleWidth);
        if (idx >= 0 && idx < candles.length) {
            const c = candles[idx];
            document.getElementById('tooltip').style.display = 'block';
            document.getElementById('tooltip').style.left = e.pageX + 10 + 'px';
            document.getElementById('tooltip').style.top = e.pageY - 20 + 'px';
            document.getElementById('tooltip').innerHTML = `O: ${c.open.toFixed(2)} H: ${c.high.toFixed(2)} L: ${c.low.toFixed(2)} C: ${c.close.toFixed(2)}`;
        } else {
            document.getElementById('tooltip').style.display = 'none';
        }
    });
    canvas.addEventListener('mouseleave', () => document.getElementById('tooltip').style.display = 'none');

    canvas.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].screenX; });
    canvas.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        // —Å–≤–∞–π–ø—ã –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–∏—Å–∫
    });

    function changePair() {
        canvas.style.opacity = '0.3';
        setTimeout(() => {
            initChart();
            canvas.style.opacity = '1';
            document.querySelectorAll('.pair-option').forEach(el => {
                if (el.querySelector('.pair-name')?.innerText === hiddenSelect.value) {
                    el.classList.add('selected');
                } else {
                    el.classList.remove('selected');
                }
            });
        }, 500);
    }

    function startAnalysis(btn) {
        const res = document.getElementById('result');
        const stat = document.getElementById('status');
        res.classList.remove('visible');
        stat.style.display = 'flex';
        btn.classList.add('loading');
        
        setTimeout(() => {
            btn.classList.remove('loading');
            stat.style.display = 'none'; 
            res.classList.add('visible');
            const isUp = Math.random() > 0.5;
            res.style.color = isUp ? '#00ff88' : '#ff4d4d';
            res.style.borderColor = isUp ? '#00ff88' : '#ff4d4d';
            let signal = `${dict[curLang][isUp?'up':'down']} (${Math.floor(Math.random()*15+82)}%)`;
            res.innerHTML = signal;
            res.style.animation = 'popIn 0.4s';
            setTimeout(() => res.style.animation = '', 400);

            if (window.Telegram?.WebApp?.HapticFeedback) {
                if (isUp) {
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                } else {
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
                }
                window.Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
            }

            confettiEffect(isUp);
        }, 1500);
    }

    function confettiEffect(isUp) {
        console.log('üéâ Confetti', isUp ? 'green' : 'red');
    }

    function selectTf(btn) {
        document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    if (window.Telegram?.WebApp) {
        window.Telegram.WebApp.expand();
    }
</script>
</body>
</html>
